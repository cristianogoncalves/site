<!DOCTYPE html>
<meta charset="utf-8">
<head>
<link rel="stylesheet" href="style.css" type='text/css'>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: auto;
  padding-top: 5px;
  position: relative;
  width: 100%;
}

div.Menu {
  height: 30px;
  width: 100%;
  display: inline-table;
  background-color: blue;
  background-size: cover;
  border-radius: 0px;
  border: 1px solid transparent;
  }

div#Grafico1 {
	display: inline-block;
	height: 500px;
  	width: 700px;
	border: 0px solid transparent;
}
div#Graficos2{
	display: inline-block;
	height: 200px;
  	width: 700px;
	border: 0px solid transparent;
}

h2 {
	position: relative;left:175px;
}

p {
	font-family:sans-serif;
  	font-weight: bold;
  	color:white;
  	font-size:160%;
 	 display: inline-block;
 	 position: relative;
 	 left: 50px;
 	 margin: 0px 0 0 0;
 	 top:7px;

}

#botoes {
  float: left;
  text-align:bottom;
}

.bar--positive {
  fill: steelblue;
}

.bar--negative {
  fill: darkorange;
}

.axis text {
  font: 12px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

</style>


<body>

	<div class="Menu">
	<form class="pure-form pure-form-stacked" id="botoes">
	    <select id="mySelect" name='form1' >
	    <option value="nulo">Rodada</option>
	    <option value="10">Rodada 10</option>
	    <!--<option value="11">Rodada 11</option>-->
	  </select>
  	</form>
	
  	<button  onclick="answers();" id="botoes" type="button" class="pure-button pure-button-primary">Atualizar</button>

  	<p>Análise do Modelo</p>

	</div>


<h2> </h2>
<div id="Grafico1"></div>
<h2> </h2>
<div id="Grafico2"></div>

<script>
	function answers(){

		var answer=document.getElementById("mySelect");
		var nrodada = answer[answer.selectedIndex].value;
		//var nrodada = "10";

		var arquivo1 = nrodada + "rodada_times.csv";
		var arquivo2 = nrodada + "rodada_posicao.csv";

		$('h2').remove();
		$('div#Grafico1').remove();
		$('div#Grafico2').remove();

		function type(d) {
		  d.Erro_Medio = +d.Erro_Medio;
		  return d;
		};

		//height 500 e 250 time e posicao

		function gera_grafico(arquivo, localid, height_defined) {

			var margin = {top: 20, right: 20, bottom: 30, left:20},
			    width = 700 - margin.left - margin.right,
			    height = height_defined - margin.top - margin.bottom;

			var x = d3.scale.linear()
			    .range([0, width]);

			var y = d3.scale.ordinal()
			    .rangeRoundBands([0, height], 0.1);

			var xAxis = d3.svg.axis()
			    .scale(x)
			    .orient("bottom");

			var yAxis = d3.svg.axis()
			    .scale(y)
			    .orient("left")
			    .tickSize(0)
			    .tickPadding(6);

			var svg = d3.select(localid).append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			  	.append("g")
			    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			  d3.tsv(arquivo, type, function(error, data) {
			  x.domain(d3.extent(data, function(d) { return d.Erro_Medio; })).nice();
			  y.domain(data.map(function(d) { return d.Time; }));

			  svg.selectAll(".bar")
			      .data(data)
			    .enter().append("rect")
			      .attr("class", function(d) { return "bar bar--" + (d.Erro_Medio < 0 ? "negative" : "positive"); })
			      .attr("x", function(d) { return x(Math.min(0, d.Erro_Medio)); })
			      .attr("y", function(d) { return y(d.Time); })
			      .attr("width", function(d) { return Math.abs(x(d.Erro_Medio) - x(0)); })
			      .attr("height", y.rangeBand());

			  svg.append("g")
			      .attr("class", "x axis")
			      .attr("transform", "translate(0," + height + ")")
			      .call(xAxis);

			  svg.append("g")
			      .attr("class", "y axis")
			      .attr("transform", "translate(" + x(0) + ",0)")
			      .call(yAxis);
			});

		};
		//document.body.innerHTML += "<h2>Rodada " + nrodada  + "</h2>";
		document.body.innerHTML += "<h2>Avaliação do Modelo - Por Time</h2>";
		document.body.innerHTML += "<div id='Grafico1'></div>";
		document.body.innerHTML += "<h2>Avaliação do Modelo - Por Posição</h2>";
		document.body.innerHTML += "<div id='Grafico2'></div>";

		//<div id="Grafico1"></div>
		
		//<div id="Grafico2"></div>

		gera_grafico(arquivo1,"div#Grafico1",500);
		gera_grafico(arquivo2,"div#Grafico2",200);
	};
		
</script>

</body>